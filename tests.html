<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IARCO 2025 Certificate Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --gold: #D4AF37;
            --blue: #1E3A8A;
            --light-blue: #3B82F6;
            --white: #FFFFFF;
            --light-gray: #F3F4F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--blue), #0F1B4D);
            color: var(--white);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid var(--gold);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--gold);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--light-gray);
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .search-section {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .certificate-section {
            flex: 2;
            min-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .certificate-preview {
            background: var(--white);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .certificate-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 70%; /* Aspect ratio for certificate */
        }

        .certificate-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
        }

        .certificate-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            padding: 10% 15%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #000;
        }

        .medal-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
        }

        .certificate-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--blue);
            margin-bottom: 10px;
        }

        .certificate-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #333;
        }

        .student-name {
            font-size: 2.8rem;
            font-weight: bold;
            color: var(--blue);
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .student-details {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }

        .performance-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
            width: 100%;
        }

        .performance-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }

        .performance-label {
            font-weight: bold;
            color: #555;
        }

        .performance-value {
            color: var(--blue);
            font-weight: bold;
        }

        .certificate-id {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-generate {
            background: var(--gold);
            color: var(--blue);
        }

        .btn-preview {
            background: var(--light-blue);
            color: white;
        }

        .btn-download {
            background: var(--blue);
            color: white;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
        }

        .student-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
            color: #333;
        }

        .student-item:hover {
            background: rgba(30, 58, 138, 0.1);
        }

        .student-item.selected {
            background: rgba(212, 175, 55, 0.2);
            border-left: 4px solid var(--gold);
        }

        .student-name-result {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .student-school {
            font-size: 0.9rem;
            color: #666;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid var(--gold);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .flag-icon {
            width: 24px;
            height: 16px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .certificate-section, .search-section {
                min-width: 100%;
            }
            
            .certificate-container {
                padding-bottom: 120%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IARCO 2025 Certificate Generator</h1>
            <p class="subtitle">Generate achievement certificates for participants</p>
        </header>

        <div class="main-content">
            <div class="search-section">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Search student by name..." id="searchInput">
                </div>
                <div class="search-results" id="searchResults">
                    <!-- Search results will appear here -->
                </div>
            </div>

            <div class="certificate-section">
                <div class="certificate-preview">
                    <div class="certificate-container" id="certificateContainer">
                        <img src="" alt="Certificate Background" class="certificate-bg" id="certificateBg">
                        <div class="certificate-content" id="certificateContent">
                            <!-- Certificate content will be dynamically generated here -->
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn-preview" id="previewBtn">
                        <i class="fas fa-eye"></i> Preview
                    </button>
                    <button class="btn-generate" id="generateBtn">
                        <i class="fas fa-certificate"></i> Generate Certificate
                    </button>
                    <button class="btn-download" id="downloadBtn" disabled>
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Generating your certificate...</p>
        </div>
    </div>

    <script>
        // Sample data (in a real implementation, this would be loaded from JSON files)
        const students = [
            {
                "student_id": "v1MrV4dT",
                "name": "Afia Anjum Aboni",
                "school": "Rajuk Uttara Model College",
                "class": "Grade 10",
                "category": "Junior",
                "year": 2024,
                "country": "Bangladesh",
                "research_proposal_title": "The Relevance of Class Disparity in the Implementation of Climate-Related Policies; an Investigation into the Different Socioeconomic Classes of Dhaka",
                "research_paper": {
                    "research_problem": 17,
                    "existing_literature": 7,
                    "research_question": 20,
                    "methodology": 18,
                    "research_topic": 12,
                    "quality_of_writing": 4,
                    "plagiarism_check_percentile": 3,
                    "presentation": {
                        "persuasiveness": 15,
                        "video_quality": 15,
                        "research_problem": 15,
                        "research_question": 13,
                        "methodology": 10
                    }
                },
                "plagiarismPenalty": 15,
                "researchPaperScore": 78,
                "presentationScore": 68,
                "submissionScore": 146,
                "scaledFinalScore": 131,
                "viewProposal": "https://drive.google.com/open?id=1aBuuRXyiIBx-908Tujbzt2vXRqBq_rzX",
                "videoPitch": "https://drive.google.com/drive/folders/17Xg1wH9C8eD0wmfxn1Z3FnDZmHy3OTIV",
                "proposal_comment": "No Comment.",
                "presentation_comment": "No Comment."
            },
            {
                "student_id": "LXd6a9ey",
                "name": "Adira Safwan",
                "school": "Maple Leaf International School",
                "class": "Grade 11",
                "category": "Senior", 
                "year": 2024,
                "country": "Bangladesh",
                "research_proposal_title": "Exploring Differences in Social Media Literacy Between Digital Natives and Digital Immigrants: A Comparative Analysis of Critical Skills and Digital Adaptability",
                "research_paper": {
                    "research_problem": 16,
                    "existing_literature": 5,
                    "research_question": 15,
                    "methodology": 17,
                    "research_topic": 13,
                    "quality_of_writing": 3,
                    "plagiarism_check_percentile": 17,
                    "presentation": {
                        "persuasiveness": 18,
                        "video_quality": 18,
                        "research_problem": 16,
                        "research_question": 16,
                        "methodology": 17
                    }
                },
                "plagiarismPenalty": 0,
                "researchPaperScore": 69,
                "presentationScore": 85,
                "submissionScore": 154,
                "scaledFinalScore": 154,
                "viewProposal": "https://iarco.org/storage/2024/junior/research_proposal/02_Adira_RP_Junior_IARCO_2024.pdf",
                "videoPitch": "https://youtu.be/Fh9clCxc2RU",
                "proposal_comment": "No Comment.",
                "presentation_comment": "No Comment."
            },
            {
                "student_id": "AB123XYZ",
                "name": "John Smith",
                "school": "International School of Science",
                "class": "Grade 12",
                "category": "Senior",
                "year": 2025,
                "country": "Canada",
                "research_proposal_title": "Advancements in Renewable Energy Storage Systems",
                "research_paper": {
                    "research_problem": 18,
                    "existing_literature": 8,
                    "research_question": 19,
                    "methodology": 17,
                    "research_topic": 15,
                    "quality_of_writing": 5,
                    "plagiarism_check_percentile": 2,
                    "presentation": {
                        "persuasiveness": 17,
                        "video_quality": 16,
                        "research_problem": 18,
                        "research_question": 17,
                        "methodology": 16
                    }
                },
                "plagiarismPenalty": 0,
                "researchPaperScore": 85,
                "presentationScore": 84,
                "submissionScore": 169,
                "scaledFinalScore": 169,
                "viewProposal": "https://example.com/proposal.pdf",
                "videoPitch": "https://youtube.com/example",
                "proposal_comment": "Excellent work.",
                "presentation_comment": "Well presented."
            }
        ];

        const flags = {
            "Bangladesh": `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 12'><rect width='20' height='12' fill='#006a4e'/><circle cx='8' cy='6' r='3.6' fill='#f42a41'/></svg>`,
            "Canada": `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 12'><rect width='20' height='12' fill='#ff0000'/><rect x='6' width='8' height='12' fill='#ffffff'/><path fill='#ff0000' d='M10 2.2 8.8 3.5h0.7v1.8h0.9V3.5h0.7L10 2.2zm0 6.6-1.4-2.1h0.9v-1h0.9v1h0.9L10 8.8z'/></svg>`,
            "Japan": `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 12'><rect width='20' height='12' fill='#ffffff'/><circle cx='10' cy='6' r='3.6' fill='#bc002d'/></svg>`
        };

        const certificates = {
            "2024": "certificate/2024.pdf",
            "2025": "certificate/2025.pdf"
        };

        const medals = {
            "gold": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#FFD700" stroke="#D4AF37" stroke-width="3"/><circle cx="50" cy="50" r="35" fill="#FFF9C4"/><text x="50" y="55" text-anchor="middle" font-size="24" font-weight="bold" fill="#B8860B">1st</text></svg>`,
            "silver": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#C0C0C0" stroke="#A9A9A9" stroke-width="3"/><circle cx="50" cy="50" r="35" fill="#F5F5F5"/><text x="50" y="55" text-anchor="middle" font-size="24" font-weight="bold" fill="#696969">2nd</text></svg>`,
            "bronze": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#CD7F32" stroke="#8B4513" stroke-width="3"/><circle cx="50" cy="50" r="35" fill="#F0E68C"/><text x="50" y="55" text-anchor="middle" font-size="24" font-weight="bold" fill="#8B4513">3rd</text></svg>`,
            "honorable": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" rx="15" fill="#3B82F6" stroke="#1E3A8A" stroke-width="3"/><text x="50" y="60" text-anchor="middle" font-size="18" font-weight="bold" fill="white">Honor</text></svg>`,
            "finalist": `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon points="50,10 90,90 10,90" fill="#3B82F6" stroke="#1E3A8A" stroke-width="3"/><text x="50" y="65" text-anchor="middle" font-size="14" font-weight="bold" fill="white">Finalist</text></svg>`
        };

        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const certificateBg = document.getElementById('certificateBg');
        const certificateContent = document.getElementById('certificateContent');
        const previewBtn = document.getElementById('previewBtn');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const loading = document.getElementById('loading');

        // Current selected student
        let selectedStudent = null;

        // Calculate ranks per category and year
        function calculateRanks(students) {
            // Group students by category and year
            const groups = {};
            
            students.forEach(student => {
                const key = `${student.category}-${student.year}`;
                if (!groups[key]) {
                    groups[key] = [];
                }
                groups[key].push(student);
            });
            
            // Sort each group by scaledFinalScore and assign ranks
            Object.keys(groups).forEach(key => {
                groups[key].sort((a, b) => b.scaledFinalScore - a.scaledFinalScore);
                groups[key].forEach((student, index) => {
                    student.rank = index + 1;
                });
            });
            
            return students;
        }

        // Initialize with calculated ranks
        calculateRanks(students);

        // Search functionality
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredStudents = students.filter(student => 
                student.name.toLowerCase().includes(searchTerm)
            );
            
            displaySearchResults(filteredStudents);
        });

        function displaySearchResults(results) {
            searchResults.innerHTML = '';
            
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="student-item">No students found</div>';
                return;
            }
            
            results.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                if (selectedStudent && selectedStudent.student_id === student.student_id) {
                    studentItem.classList.add('selected');
                }
                
                studentItem.innerHTML = `
                    <div class="student-name-result">${student.name}</div>
                    <div class="student-school">${student.school} • ${student.category} • ${student.year}</div>
                `;
                
                studentItem.addEventListener('click', () => {
                    selectStudent(student);
                });
                
                searchResults.appendChild(studentItem);
            });
        }

        function selectStudent(student) {
            selectedStudent = student;
            
            // Update UI to show selected student
            const allItems = document.querySelectorAll('.student-item');
            allItems.forEach(item => item.classList.remove('selected'));
            
            const selectedItem = Array.from(allItems).find(item => 
                item.querySelector('.student-name-result').textContent === student.name
            );
            
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            // Enable buttons
            previewBtn.disabled = false;
            generateBtn.disabled = false;
            
            // Update certificate preview
            updateCertificatePreview();
        }

        function updateCertificatePreview() {
            if (!selectedStudent) return;
            
            // Set certificate background based on year
            const year = selectedStudent.year;
            certificateBg.src = certificates[year] || certificates["2025"];
            
            // Determine medal based on rank
            let medalSvg = medals.finalist;
            if (selectedStudent.rank === 1) {
                medalSvg = medals.gold;
            } else if (selectedStudent.rank === 2) {
                medalSvg = medals.silver;
            } else if (selectedStudent.rank === 3) {
                medalSvg = medals.bronze;
            } else if (selectedStudent.rank <= 10) {
                medalSvg = medals.honorable;
            }
            
            // Get flag SVG
            const flagSvg = flags[selectedStudent.country] || '';
            
            // Generate certificate ID
            const certId = generateCertificateId(selectedStudent);
            
            // Update certificate content
            certificateContent.innerHTML = `
                <div class="medal-icon">${medalSvg}</div>
                <div class="certificate-title">CERTIFICATE OF ACHIEVEMENT</div>
                <div class="certificate-subtitle">International Academic Research Conference Olympiad ${selectedStudent.year}</div>
                <div class="student-name">${selectedStudent.name}</div>
                <div class="student-details">${selectedStudent.school}</div>
                <div class="student-details">${selectedStudent.class} • ${selectedStudent.category} Category</div>
                <div class="student-details">
                    <span class="flag-icon">${flagSvg}</span>
                    ${selectedStudent.country}
                </div>
                <div class="performance-details">
                    <div class="performance-item">
                        <span class="performance-label">Overall Rank:</span>
                        <span class="performance-value">${selectedStudent.rank}</span>
                    </div>
                    <div class="performance-item">
                        <span class="performance-label">Research Proposal Score:</span>
                        <span class="performance-value">${selectedStudent.researchPaperScore}</span>
                    </div>
                    <div class="performance-item">
                        <span class="performance-label">Presentation Score:</span>
                        <span class="performance-value">${selectedStudent.presentationScore}</span>
                    </div>
                    <div class="performance-item">
                        <span class="performance-label">Total Score:</span>
                        <span class="performance-value">${selectedStudent.scaledFinalScore}</span>
                    </div>
                </div>
                <div class="certificate-id">Certificate ID: ${certId}</div>
            `;
        }

        function generateCertificateId(student) {
            const year = student.year;
            const category = student.category.substring(0, 3).toUpperCase();
            const rank = student.rank;
            const timestamp = Date.now().toString(36).toUpperCase();
            
            return `${year}-${category}-${rank}-${timestamp}`;
        }

        // Button event listeners
        previewBtn.addEventListener('click', () => {
            if (!selectedStudent) return;
            updateCertificatePreview();
            alert('Certificate preview updated!');
        });

        generateBtn.addEventListener('click', () => {
            if (!selectedStudent) return;
            
            loading.style.display = 'block';
            
            // Simulate generation process
            setTimeout(() => {
                loading.style.display = 'none';
                downloadBtn.disabled = false;
                alert('Certificate generated successfully! Click "Download PDF" to save.');
            }, 2000);
        });

        downloadBtn.addEventListener('click', () => {
            if (!selectedStudent) return;
            
            const element = document.getElementById('certificateContainer');
            const opt = {
                margin: 0,
                filename: `IARCO_${selectedStudent.year}_Certificate_${selectedStudent.name.replace(/\s+/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            
            // Show loading
            loading.style.display = 'block';
            
            // Generate PDF
            html2pdf().set(opt).from(element).save().then(() => {
                loading.style.display = 'none';
                alert('PDF downloaded successfully!');
            });
        });

        // Initialize with all students
        displaySearchResults(students);
    </script>
</body>
</html>
